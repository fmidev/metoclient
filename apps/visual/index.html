<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>metoclient-ui</title>
    <script src="https://oss.maxcdn.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.13/moment-timezone-with-data.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/EventEmitter/5.2.2/EventEmitter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-timer/1.0.7/d3-timer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.0.0/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>
    <link href='static/css/ol.css' rel='stylesheet' type='text/css'>
    <link href='static/css/ol-layerswitcher.css' rel='stylesheet' type='text/css'>
    <link href='static/css/ol-popup.css' rel='stylesheet' type='text/css'>
    <link href='static/css/example.css' rel='stylesheet' type='text/css'>
    <link href='static/css/spinner.css' rel='stylesheet' type='text/css'>
</head>

<body>
<div id="fmi-metoclient-ui"></div>
<!-- built files will be auto injected -->
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (event) {

        console.log("Ready");

        var API_KEY = '';
        if (!API_KEY || API_KEY === 'insert-your-apikey-here') {
            var apiKeyErrorStr = 'Check HTML source! Proper API-KEY should be set!';
            // Todo:
            //jQuery('#animationStatus').html(apiKeyErrorStr);
            alert(apiKeyErrorStr);
        } else {
            // Create animation layers.

            // Initialize options objects for animation.
            var resolutionTime = 30 * 60 * 1000;
            var currentDate = new Date();
            var currentTime = fi.fmi.metoclient.ui.animator.Utils.floorTime(currentDate.getTime(), 60 * 60 * 1000);
            var beginTime = currentTime - 5.5 * 60 * 60 * 1000;
            var endTime = currentTime + 3.5 * 60 * 60 * 1000;
            beginDate = fi.fmi.metoclient.ui.animator.Utils.floorTime(beginTime, 60 * 60 * 1000);
            var baseUrl = 'http://wms.fmi.fi/fmi-apikey/' + API_KEY + '/geoserver/';
            var wmsBaseUrl = baseUrl + 'wms';
            var wmtsBaseUrl = baseUrl + 'gwc/service/wmts';
            var resolutions = [2048, 1024, 512, 256, 128, 64];
            var matrixIds = [
                'ETRS-TM35FIN:2',
                'ETRS-TM35FIN:3',
                'ETRS-TM35FIN:4',
                'ETRS-TM35FIN:5',
                'ETRS-TM35FIN:6',
                'ETRS-TM35FIN:7'
            ];
            var origin = [-4537345.568, 8254755.58];
            var origins1024 = [[-118331.36640836, 8432773.1670142], [-118331.36640836, 8432773.1670142], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352]];
            var extent = [-118331.366408356, 6335621.16701424, 875567.731906565, 7907751.53726352];
            var metOClientConfig = {
                project: 'mymap',
                // Map view configurations
                map: {
                    model: {
                        // Layer configuration
                        layers: [
                            // ---------------------------------------------------------------
                            {
                                className: 'ImageWMS',
                                title: 'Basic Map',
                                visible: true,
                                opacity: 0.5,
                                editOpacity: true,
                                type: 'map',
                                sourceOptions: {
                                    url: wmsBaseUrl,
                                    params: {
                                        'LAYERS': 'KAP:BasicMap'
                                    }
                                }
                            },
                            {
                                className: 'WMTS',
                                title: 'Basic Map WMTS',
                                visible: true,
                                editOpacity: true,
                                type: 'map',
                                sourceOptions: {
                                    layer: 'KAP:Europe_Basic_NoNames',
                                    name: 'Map',
                                    url: wmtsBaseUrl,
                                    format: 'image/png',
                                    style: '',
                                    matrixSet: 'ETRS-TM35FIN',
                                    projection: 'EPSG:3067',
                                    tileGridOptions: {
                                        matrixIds: matrixIds,
                                        resolutions: resolutions,
                                        origin: origin,
                                        tileSize: 256,
                                        extent: extent
                                    }
                                }
                            },
                            {
                                className: 'TileWMS',
                                title: 'Dbz',
                                visible: true,
                                editOpacity: true,
                                type: 'obs',
                                sourceOptions: {
                                    url: wmsBaseUrl,
                                    params: {
                                        'LAYERS': 'Radar:suomi_dbz_eureffin',
                                        'TRANSPARENT': 'TRUE',
                                        'FORMAT': 'image/png'
                                    },
                                    projection: 'EPSG:3067',
                                    tileGridOptions: {
                                        origins: origins1024,
                                        extent: extent,
                                        resolutions: resolutions,
                                        tileSize: 1024
                                    }
                                },
                                animation: {
                                    beginTime: beginTime,
                                    endTime: currentTime,
                                    resolutionTime: resolutionTime,
                                    hasLegend: true,
                                    legendVisible: true
                                }
                            },
                            {
                                className: 'Vector',
                                type: 'features',
                                title: 'Markers',
                                visible: true,
                                editOpacity: true,
                                popup: true,
                                source: {
                                    projection: 'EPSG:4326',
                                    features: [
                                        {
                                            type: 'Point',
                                            geometry: [25, 61],
                                            name: 'Point A',
                                            population: 1000,
                                            text: 'Description A'
                                        },
                                        {
                                            type: 'Point',
                                            geometry: [26, 63],
                                            name: 'Point B',
                                            population: 2000,
                                            text: 'Description B'
                                        }
                                    ]
                                },
                                style: [
                                    {
                                        image: {
                                            type: 'icon',
                                            anchor: [0.5, 0.5],
                                            anchorXUnits: 'fraction',
                                            anchorYUnits: 'fraction',
                                            opacity: 0.75,
                                            scale: 0.2,
                                            src: './static/img/200px-Red_circle.png'
                                        }
                                    }
                                ]
                            },
                        ]
                    },
                    view: {
                        container: 'fmi-animator',
                        projection: 'EPSG:3857',
                        extent: [-500000, 5000000, 5000000, 20000000],
                        resolutions: resolutions,
                        defaultCenterLocation: [2750000, 9000000],
                        defaultCenterProjection: 'EPSG:3857',
                        defaultZoomLevel: 0,
                        showLegend: true,
                        legendTitle: 'Legend',
                        noLegendText: 'None',
                        showLayerSwitcher: true,
                        showLoadProgress: true,
                        ignoreObsOffset: 5 * 60 * 1000,
                        maxAsyncLoadCount: 5,
                        // Disable panning and zooming
                        staticControls: false
                    }
                },
                // Time configuration
                time: {
                    model: {
                        autoStart: false,
                        waitUntilLoaded: false,
                        autoReplay: true,
                        refreshInterval: 15 * 60 * 1000,
                        frameRate: 500,
                        resolutionTime: resolutionTime,
                        defaultAnimationTime: (new Date()).getTime(),
                        beginTime: beginTime,
                        endTime: endTime,
                        endTimeDelay: 1000
                    },
                    view: {
                        playImagePath: 'static/img/play.png',
                        pauseImagePath: 'static/img/pause.png',
                        showTimeSlider: true,
                        timeZone: 'Europe/Helsinki',
                        imageWidth: 55,
                        imageHeight: 55,
                        imageBackgroundColor: '#585858',
                        sliderOffset: 55,
                        sliderHeight: 55,
                        statusHeight: 12,
                        tickTextColor: '#000000',
                        pastColor: '#B2D8EA',
                        futureColor: '#D7B13E',
                        tickColor: '#FFFFFF',
                        notLoadedColor: '#585858',
                        loadingColor: '#B2D8EA',
                        loadedColor: '#94BF77',
                        loadingErrorColor: '#9A2500',
                        tickHeight: 24,
                        tickTextYOffset: 18,
                        tickTextSize: 12,
                        pointerHeight: 30,
                        pointerTextOffset: 15,
                        pointerColor: '#585858',
                        pointerTextColor: '#D7B13E',
                        pointerTextSize: 12
                    }
                },
                localization: {
                    locale: 'fi',
                    fi: {
                        overlays: 'Sääaineistot',
                        baseLayers: 'Taustakartat',
                        features: 'Kohteet',
                        legend: 'Selite',
                        noLegend: 'Ei selitettä',
                        zoomInTooltip: 'Lähennä',
                        zoomOutTooltip: 'Loitonna',
                        layersTooltip: 'Karttatasot',
                        browserNotSupported: 'Tämä selain ei ole tuettu.'
                    },
                    en: {
                        overlays: 'Overlays',
                        baseLayers: 'Base layers',
                        features: 'Features',
                        legend: 'Legend',
                        noLegend: 'None',
                        zoomInTooltip: 'Zoom in',
                        zoomOutTooltip: 'Zoom out',
                        layersTooltip: 'Layers',
                        browserNotSupported: 'This browser is not supported.'
                    }
                }
            };
        }
        fi.fmi.metoclient_ui.init({
            container: '#fmi-metoclient-ui',
            animator: metOClientConfig,
            graph: {},
            grid: {}
        });
    });
</script>
</body>

</html>
