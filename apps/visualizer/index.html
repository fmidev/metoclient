<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>MetOClient Visualizer</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js'></script>
    <link href='static/css/map.css' rel='stylesheet' type='text/css'>
    <link href='static/css/example.css' rel='stylesheet' type='text/css'>
</head>

<body>
<div id="fmi-metoclient-ui"></div>
<!-- built files will be auto injected -->
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function (event) {
    var API_KEY = 'insert-your-apikey-here'
    if (!API_KEY) {
      var apiKeyErrorStr = 'Check HTML source! Proper API-KEY should be set!'
      alert(apiKeyErrorStr)
    } else {
      // Create animation layers.

      // Initialize options objects for animation.
      var resolutionTime = 60 * 60 * 1000
      var currentTime = Math.floor(Date.now()/resolutionTime)*resolutionTime
      var beginTime = currentTime - 5 * resolutionTime
      var endTime = currentTime + 5 * resolutionTime
      var baseUrl = 'http://wms.fmi.fi/fmi-apikey/' + API_KEY + '/geoserver/'
      var wmsBaseUrl = baseUrl + 'wms'
      var resolutions = [2048, 1024, 512, 256, 128, 64]
      var origins1024 = [[-118331.36640836, 8432773.1670142], [-118331.36640836, 8432773.1670142], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352]]
      var extent = [-118331.366408356, 6335621.16701424, 875567.731906565, 7907751.53726352]
      var metOClientConfig = {
        project: 'mymap',
        // Map view configurations
        map: {
          model: {
            // Layer configuration
            layers: [
              // ---------------------------------------------------------------
              {
                className: 'OSM',
                title: 'OpenStreetMap',
                visible: true,
                editOpacity: true
              },
              // ---------------------------------------------------------------
              {
                className: 'Stamen',
                title: 'Water Color',
                visible: false,
                editOpacity: true,
                sourceOptions: {
                  layer: 'watercolor'
                }
              },
              // ---------------------------------------------------------------
              {
                className: 'TileWMS',
                title: 'Rain radar and humidity forecast',
                visible: true,
                editOpacity: true,
                type: 'obs',
                sourceOptions: {
                  url: wmsBaseUrl,
                  params: {
                    'LAYERS': 'Radar:suomi_rr_eureffin',
                    'TRANSPARENT': 'TRUE',
                    'FORMAT': 'image/png'
                  },
                  projection: 'EPSG:3067',
                  tileGridOptions: {
                    origins: origins1024,
                    extent: extent,
                    resolutions: resolutions,
                    tileSize: 1024
                  }
                },
                animation: {
                  beginTime: beginTime,
                  resolutionTime: resolutionTime,
                  hasLegend: false,
                }
              },
              // ---------------------------------------------------------------
              {
                className: 'TileWMS',
                title: 'Rain radar and humidity forecast',
                visible: true,
                editOpacity: true,
                type: 'for',
                sourceOptions: {
                  url: wmsBaseUrl,
                  params: {
                    'LAYERS': 'Weather:precipitation-forecast',
                    'TRANSPARENT': 'TRUE',
                    'FORMAT': 'image/png'
                  },
                  projection: 'EPSG:3067',
                  tileGridOptions: {
                    origins: origins1024,
                    extent: extent,
                    resolutions: resolutions,
                    tileSize: 1024
                  }
                },
                animation: {
                  endTime: endTime,
                  resolutionTime: resolutionTime,
                  hasLegend: false
                }
              },
              // ---------------------------------------------------------------
              {
                className: 'TileWMS',
                title: 'Cloudiness forecast',
                visible: false,
                editOpacity: true,
                type: 'for',
                sourceOptions: {
                  url: wmsBaseUrl,
                  params: {
                    'LAYERS': 'Weather:cloudiness-forecast',
                    'TRANSPARENT': 'TRUE',
                    'FORMAT': 'image/png'
                  },
                  projection: 'EPSG:3067',
                  tileGridOptions: {
                    origins: origins1024,
                    extent: extent,
                    resolutions: resolutions,
                    tileSize: 1024
                  }
                },
                animation: {
                  beginTime: currentTime,
                  endTime: endTime,
                  resolutionTime: 2 * resolutionTime,
                  hasLegend: true
                }
              },
              // ---------------------------------------------------------------
              {
                className: 'TileWMS',
                title: 'Temperature forecast',
                visible: true,
                editOpacity: true,
                type: 'for',
                sourceOptions: {
                  url: wmsBaseUrl,
                  params: {
                    'LAYERS': 'Weather:temperature-forecast-contour',
                    'TRANSPARENT': 'TRUE',
                    'FORMAT': 'image/png'
                  },
                  projection: 'EPSG:3067',
                  tileGridOptions: {
                    origins: origins1024,
                    extent: extent,
                    resolutions: resolutions,
                    tileSize: 1024
                  }
                },
                animation: {
                  endTime: endTime,
                  resolutionTime: resolutionTime,
                  hasLegend: false
                }
              }
            ]
          },
          view: {
            container: 'fmi-animator',
            projection: 'EPSG:3857',
            extent: [-500000, 5000000, 5000000, 20000000],
            resolutions: resolutions,
            defaultCenterLocation: [2750000, 9000000],
            defaultCenterProjection: 'EPSG:3857',
            defaultZoomLevel: 0,
            showLegend: true,
            legendTitle: 'Legend',
            noLegendText: 'None',
            showLayerSwitcher: true,
            showLoadProgress: true,
            ignoreObsOffset: 5 * 60 * 1000,
            maxAsyncLoadCount: 5,
            // Disable panning and zooming
            staticControls: false
          }
        },
        // Time configuration
        time: {
          model: {
            autoStart: false,
            waitUntilLoaded: false,
            autoReplay: true,
            refreshInterval: 15 * 60 * 1000,
            frameRate: 500,
            resolutionTime: resolutionTime,
            defaultAnimationTime: (new Date()).getTime(),
            beginTime: beginTime,
            endTime: endTime,
            endTimeDelay: 1000
          }
          ,
          view: {
            playImagePath: 'static/img/play.png',
            pauseImagePath: 'static/img/pause.png',
            showTimeSlider: true,
            timeZone: 'Europe/Helsinki',
            imageWidth: 55,
            imageHeight: 55,
            imageBackgroundColor: '#585858',
            sliderOffset: 55,
            sliderHeight: 55,
            statusHeight: 12,
            tickTextColor: '#000000',
            pastColor: '#B2D8EA',
            futureColor: '#D7B13E',
            tickColor: '#FFFFFF',
            notLoadedColor: '#585858',
            loadingColor: '#B2D8EA',
            loadedColor: '#94BF77',
            loadingErrorColor: '#9A2500',
            tickHeight: 24,
            tickTextYOffset: 18,
            tickTextSize: 12,
            pointerHeight: 30,
            pointerTextOffset: 15,
            pointerColor: '#585858',
            pointerTextColor: '#D7B13E',
            pointerTextSize: 12
          }
        }
        ,
        localization: {
          locale: 'fi',
          fi: {
            overlays: 'Sääaineistot',
            baseLayers: 'Taustakartat',
            features: 'Kohteet',
            legend: 'Selite',
            noLegend: 'Ei selitettä',
            zoomInTooltip: 'Lähennä',
            zoomOutTooltip: 'Loitonna',
            layersTooltip: 'Karttatasot',
            browserNotSupported: 'Tämä selain ei ole tuettu.'
          }
          ,
          en: {
            overlays: 'Overlays',
            baseLayers: 'Base layers',
            features: 'Features',
            legend: 'Legend',
            noLegend: 'None',
            zoomInTooltip: 'Zoom in',
            zoomOutTooltip: 'Zoom out',
            layersTooltip: 'Layers',
            browserNotSupported: 'This browser is not supported.'
          }
        }
      }
    }
    fi.fmi.metoclient.visualizer.init({
      container: '#fmi-metoclient-ui',
      animator: metOClientConfig,
      graph: {},
      grid: {}
    })
  })
</script>
</body>

</html>
