<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controller/MapController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controller/MapController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Map controller for animator.
 * @author Finnish Meteorological Institute
 * @license MIT
 */

import Map from '../model/Map'
import LazyAnimationLoader from '../view/map/LazyAnimationLoader'
import FullAnimationLoader from '../view/map/FullAnimationLoader'
import EventEmitter from 'wolfy87-eventemitter'
import 'core-js/fn/promise'

export default class MapController {
  /**
   * Constructs a new map controller.
   * @param {Object} config User configuration.
   * @param {number} referenceTime World creation time.
   * @constructor
   */
  constructor (config, referenceTime) {
    /**
     * @type {Object}
     * @private
     */
    this.config_ = config
    this.actionEvents = new EventEmitter()
    this.variableEvents = new EventEmitter()
    /**
     * @type {Object}
     * @private
     */
    this.model_ = new Map(config['model'], referenceTime)
    /**
     * @type {Object}
     * @private
     */
    this.view_ = (config['view']['mapLoader'] === 'all') ? new FullAnimationLoader(config['view']) : new LazyAnimationLoader(config['view'])
    this.reloadListener_ = () => {
    }
    this.numIntervalItemsListener_ = () => {
    }
  }

  /**
   * Produces a new map.
   * @param {number=} currentTime Current real-world time.
   * @param {number=} animationTime Animation time.
   * @param {number=} animationBeginTime Animation begin time.
   * @param {number=} animationEndTime Animation end time.
   * @param {number=} animationResolutionTime Animation resolution time.
   * @param {number=} animationNumIntervals Number of animation time intervals.
   * @param {Object=} callbacks Callback functions for map events.
   * @param {boolean=} useConfig Use layer configuration values.
   */
  createMap (currentTime, animationTime, animationBeginTime, animationEndTime, animationResolutionTime, animationNumIntervals, callbacks, useConfig = false) {
    const self = this
    const capabilities = {}
    let layers
    let promises
    // console.log("Start to load capabilities.");
    // console.log(goog.now());
    this.model_.refreshLayers(currentTime, animationResolutionTime)
    promises = this.model_.loadCapabilities(capabilities)
    layers = this.model_.getLayers()
    this.reloadListener_ = () => {
      self.actionEvents.emitEvent('reload')
    }
    // The listener will not be added if it is a duplicate.
    this.view_.actionEvents.addListener('reload', this.reloadListener_)
    this.numIntervalItemsListener_ = numIntervalItems => {
      self.variableEvents.emitEvent('numIntervalItems', [numIntervalItems])
    }
    // The listener will not be added if it is a duplicate.
    this.view_.variableEvents.addListener('numIntervalItems', this.numIntervalItemsListener_)
    // Capabilities loaded
    Promise
      .all(promises.map(p => p.catch(e => e)))
      .then(values => {
        self.view_.createAnimation(layers, capabilities, currentTime, animationTime, animationBeginTime, animationEndTime, animationResolutionTime, animationNumIntervals, callbacks, useConfig)
      })
      .catch(e => console.log(e))
  }

  /**
   * Refreshes the animation map.
   */
  refreshMap () {
    this.view_.createAnimation()
  }

  /**
   * Destroys the animation map.
   */
  destroyAnimation () {
    this.actionEvents.removeAllListeners()
    this.variableEvents.removeAllListeners()
    this.view_.destroyAnimation()
  }

  /**
   * Sets the animation time.
   * @param {number} animationTime Animation time.
   */
  setAnimationTime (animationTime) {
    this.view_.setAnimationTime(animationTime)
  }

  /**
   * Gets the number of animation time intervals.
   * @returns {number} The number of time intervals.
   */
  getAnimationNumIntervals () {
    return this.model_.getAnimationNumIntervals()
  }

  /**
   * Sets map zoom level.
   * @param {number} level Zoom level.
   */
  setZoom (level) {
    this.view_.setZoom(level)
  }

  /**
   * Sets map center.
   * @param {Array} coordinates Center coordinates.
   */
  setCenter (coordinates) {
    this.view_.setCenter(coordinates)
  }

  /**
   * Sets map rotation.
   * @param {number} angle Rotation.
   */
  setRotation (angle) {
    this.view_.setRotation(angle)
  }

  /**
   * Sets the map layers.
   * @param layers Map layers.
   */
  setLayers (layers) {
    this.model_.setLayers(layers)
  }

  /**
   * Updates the map layers.
   * @param layers Map layers.
   */
  updateLayers (layers) {
    this.model_.updateLayers(layers)
  }

  /**
   * Gets the animation map.
   * @return {Object} Animation map.
   */
  getMap () {
    return this.view_.getMap()
  }

  /**
   * Gets vector layer features.
   * @param layerTitle {string} Vector layer title.
   * @param invisible {boolean=} Return also invisible layers.
   * @return {Array&lt;Object>} Features.
   */
  getFeatures (layerTitle, invisible = false) {
    return this.view_.getFeatures(layerTitle, invisible)
  }

  /**
   * Gets vector layer features at given location.
   * @param layerTitle {string} Vector layer title.
   * @param coordinate {Array} Vector coordinates.
   * @param tolerance {number} Coordinate resolution in pixels.
   * @return {Array&lt;Object>} Features.
   */
  getFeaturesAt (layerTitle, coordinate, tolerance) {
    return this.view_.getFeaturesAt(layerTitle, coordinate, tolerance)
  }

  /**
   * Adds features to vector layer.
   * @param layerTitle {string} Vector layer title.
   * @param projection {string} Projection.
   * @param featureOptions {Array&lt;Object>} New feature options.
   */
  addFeatures (layerTitle, projection, featureOptions) {
    this.view_.addFeatures(layerTitle, projection, featureOptions)
  }

  /**
   * Removes all features from a vector layer.
   * @param layerTitle {string} Vector layer title.
   */
  clearFeatures (layerTitle) {
    this.view_.clearFeatures(layerTitle)
  }

  /**
   * Selects a vector feature.
   * @param {Object} feature Feature to be selected.
   */
  selectFeature (feature) {
    this.view_.selectFeature(feature)
  }

  /**
   * Shows a popup window on the map.
   * @param content {string} HTML content of the popup window.
   * @param coordinate {Array} Popup coordinates.
   * @param append {boolean=} Append content into popup, if it already exists and is located at the same coordinates.
   */
  showPopup (content, coordinate, append) {
    this.view_.showPopup(content, coordinate, append)
  }

  /**
   * Hides popup window on the map.
   */
  hidePopup () {
    this.view_.hidePopup()
  }

  /**
   * Gets a map layer.
   * @param layerTitle {string} Layer title.
   * @return {Object} Map layer.
   */
  getLayer (layerTitle) {
    return this.view_.getLayer(layerTitle)
  }

  /**
   * Gets map layers.
   * @returns {Array} Map layers.
   */
  getLayerConfigs() {
    return this.model_.getLayers()
  }

  /**
   * Request a map view update.
   */
  requestViewUpdate () {
    this.view_.requestViewUpdate()
  }

  /**
   * Sets layer visibility.
   * @param layerTitle {string} Layer title.
   * @param visibility {boolean} Layer visibility.
   */
  setLayerVisible (layerTitle, visibility) {
    this.view_.setLayerVisible(layerTitle, visibility)
  }

  /**
   * Sets marker visibility.
   * @param visibility {boolean} Marker visibility.
   */
  setMarkerVisible (visibility) {
    this.view_.setMarkerVisible(visibility)
  }

  /**
   * Sets map interactions.
   * @param interactionOptions {Object} Interaction options.
   */
  setInteractions (interactionOptions) {
    this.view_.setInteractions(interactionOptions)
  }

  /**
   * Enables or disables static map controls.
   * @param staticControls {boolean} Static controls status.
   */
  setStaticControls (staticControls) {
    this.view_.setStaticControls(staticControls)
  }

  /**
   * Returns static map controls status.
   * @return {boolean} Static controls status.
   */
  getStaticControls () {
    return this.view_.getStaticControls()
  }

  /**
   * Sets callback functions.
   * @param callbacks {Object} Callback functions.
   */
  setCallbacks (callbacks) {
    this.view_.setCallbacks(callbacks)
  }

  /**
   * Sets the capabilities data.
   * @param {Object} capabilities Capabilities data.
   */
  setCapabilities (capabilities) {
    this.model_.setCapabilities(capabilities)
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Base.html">Base</a></li><li><a href="Html.html">Html</a></li><li><a href="Internal.html">Internal</a></li><li><a href="MetOClient_MetOClient.html">MetOClient</a></li><li><a href="module.exports.html">exports</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="TimeFrame.module.exports.html">module.exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addFeatures">addFeatures</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#clearFeatures">clearFeatures</a></li><li><a href="global.html#configureTicks">configureTicks</a></li><li><a href="global.html#createContainers">createContainers</a></li><li><a href="global.html#createFrame">createFrame</a></li><li><a href="global.html#createFrames">createFrames</a></li><li><a href="global.html#createIndicators">createIndicators</a></li><li><a href="global.html#createMap">createMap</a></li><li><a href="global.html#createMenu">createMenu</a></li><li><a href="global.html#createPointer">createPointer</a></li><li><a href="global.html#createPostTools">createPostTools</a></li><li><a href="global.html#createPreMargin">createPreMargin</a></li><li><a href="global.html#createPreTools">createPreTools</a></li><li><a href="global.html#createTicks">createTicks</a></li><li><a href="global.html#createTime">createTime</a></li><li><a href="global.html#createTimeMenu">createTimeMenu</a></li><li><a href="global.html#createTimer">createTimer</a></li><li><a href="global.html#createTimeSlider">createTimeSlider</a></li><li><a href="global.html#createTimeZoneLabel">createTimeZoneLabel</a></li><li><a href="global.html#destroyAnimation">destroyAnimation</a></li><li><a href="global.html#destroyTime">destroyTime</a></li><li><a href="global.html#destroyTimer">destroyTimer</a></li><li><a href="global.html#destroyTimeSlider">destroyTimeSlider</a></li><li><a href="global.html#featureFactory">featureFactory</a></li><li><a href="global.html#filters">filters</a></li><li><a href="global.html#floorTime">floorTime</a></li><li><a href="global.html#getAnimationBackupTime">getAnimationBackupTime</a></li><li><a href="global.html#getAnimationBeginTime">getAnimationBeginTime</a></li><li><a href="global.html#getAnimationEndTime">getAnimationEndTime</a></li><li><a href="global.html#getAnimationNumIntervals">getAnimationNumIntervals</a></li><li><a href="global.html#getAnimationResolutionTime">getAnimationResolutionTime</a></li><li><a href="global.html#getAnimationTime">getAnimationTime</a></li><li><a href="global.html#getAnimationTimes">getAnimationTimes</a></li><li><a href="global.html#getCapabilities">getCapabilities</a></li><li><a href="global.html#getCreationTime">getCreationTime</a></li><li><a href="global.html#getCurrentTime">getCurrentTime</a></li><li><a href="global.html#getFeatures">getFeatures</a></li><li><a href="global.html#getFeaturesAt">getFeaturesAt</a></li><li><a href="global.html#getLayer">getLayer</a></li><li><a href="global.html#getLayerConfigs">getLayerConfigs</a></li><li><a href="global.html#getLayers">getLayers</a></li><li><a href="global.html#getMap">getMap</a></li><li><a href="global.html#getRefreshInterval">getRefreshInterval</a></li><li><a href="global.html#getStaticControls">getStaticControls</a></li><li><a href="global.html#getTickText">getTickText</a></li><li><a href="global.html#getTimeConfiguration">getTimeConfiguration</a></li><li><a href="global.html#getTimeLimitsForced">getTimeLimitsForced</a></li><li><a href="global.html#handleRefresh_">handleRefresh_</a></li><li><a href="global.html#handleTimer_">handleTimer_</a></li><li><a href="global.html#hidePopup">hidePopup</a></li><li><a href="global.html#isValidRefreshInterval">isValidRefreshInterval</a></li><li><a href="global.html#isWaitingAutoStart">isWaitingAutoStart</a></li><li><a href="global.html#layerFactory">layerFactory</a></li><li><a href="global.html#LEGEND_CONTAINER_CLASS">LEGEND_CONTAINER_CLASS</a></li><li><a href="global.html#LEGEND_FIGURE_CLASS_PREFIX">LEGEND_FIGURE_CLASS_PREFIX</a></li><li><a href="global.html#loadCapabilities">loadCapabilities</a></li><li><a href="global.html#loadFunction">loadFunction</a></li><li><a href="global.html#LOADING_STATUS">LOADING_STATUS</a></li><li><a href="global.html#MAX_TIMESTAMP">MAX_TIMESTAMP</a></li><li><a href="global.html#moveAnimationTimeFrame">moveAnimationTimeFrame</a></li><li><a href="global.html#next">next</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#previous">previous</a></li><li><a href="global.html#produceFullLayerConfig">produceFullLayerConfig</a></li><li><a href="global.html#refreshLayers">refreshLayers</a></li><li><a href="global.html#refreshMap">refreshMap</a></li><li><a href="global.html#refreshTime">refreshTime</a></li><li><a href="global.html#requestViewUpdate">requestViewUpdate</a></li><li><a href="global.html#resetAnimationBackupTime">resetAnimationBackupTime</a></li><li><a href="global.html#selectFeature">selectFeature</a></li><li><a href="global.html#setAnimationLastRefreshed">setAnimationLastRefreshed</a></li><li><a href="global.html#setAnimationPlay">setAnimationPlay</a></li><li><a href="global.html#setAnimationTime">setAnimationTime</a></li><li><a href="global.html#setAnimationTimes">setAnimationTimes</a></li><li><a href="global.html#setBeginTime">setBeginTime</a></li><li><a href="global.html#setCallbacks">setCallbacks</a></li><li><a href="global.html#setCapabilities">setCapabilities</a></li><li><a href="global.html#setCenter">setCenter</a></li><li><a href="global.html#setCurrentTime">setCurrentTime</a></li><li><a href="global.html#setDayStartOffset">setDayStartOffset</a></li><li><a href="global.html#setDefaultTime">setDefaultTime</a></li><li><a href="global.html#setDragging">setDragging</a></li><li><a href="global.html#setEndTime">setEndTime</a></li><li><a href="global.html#setFirstDataPointTime">setFirstDataPointTime</a></li><li><a href="global.html#setFrameRate">setFrameRate</a></li><li><a href="global.html#setGridTime">setGridTime</a></li><li><a href="global.html#setInteractions">setInteractions</a></li><li><a href="global.html#setLastDataPointTime">setLastDataPointTime</a></li><li><a href="global.html#setLayers">setLayers</a></li><li><a href="global.html#setLayerVisible">setLayerVisible</a></li><li><a href="global.html#setMarkerVisible">setMarkerVisible</a></li><li><a href="global.html#setResolutionTime">setResolutionTime</a></li><li><a href="global.html#setRotation">setRotation</a></li><li><a href="global.html#setStaticControls">setStaticControls</a></li><li><a href="global.html#setTimeLimitsForced">setTimeLimitsForced</a></li><li><a href="global.html#setTimeStep">setTimeStep</a></li><li><a href="global.html#setTimeZone">setTimeZone</a></li><li><a href="global.html#setTimeZoneLabel">setTimeZoneLabel</a></li><li><a href="global.html#setZoom">setZoom</a></li><li><a href="global.html#showPopup">showPopup</a></li><li><a href="global.html#showTicks">showTicks</a></li><li><a href="global.html#sourceFactory">sourceFactory</a></li><li><a href="global.html#step">step</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#styleFactory">styleFactory</a></li><li><a href="global.html#supportOldBrowsers">supportOldBrowsers</a></li><li><a href="global.html#transformCoordinates">transformCoordinates</a></li><li><a href="global.html#updateAnimationBackupTime">updateAnimationBackupTime</a></li><li><a href="global.html#updateLayers">updateLayers</a></li><li><a href="global.html#updatePointer">updatePointer</a></li><li><a href="global.html#updateTimeLoaderVis">updateTimeLoaderVis</a></li><li><a href="global.html#updateTimeLoaderVisualizations">updateTimeLoaderVisualizations</a></li><li><a href="global.html#updateTimeSlider">updateTimeSlider</a></li><li><a href="global.html#updateTimeSteps">updateTimeSteps</a></li><li><a href="global.html#urlToDataUrl">urlToDataUrl</a></li><li><a href="global.html#ZINDEX">ZINDEX</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Thu Jun 06 2019 10:54:33 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
