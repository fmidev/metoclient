<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Common utility functions for working with animator.
 * @author Finnish Meteorological Institute
 * @license MIT
 */

import { default as proj4 } from 'proj4'
import { tz } from 'moment-timezone'
import moment from 'moment-timezone'
import fi from 'moment/locale/fi'
import sv from 'moment/locale/sv'
import uk from 'moment/locale/uk'

/**
 * Floors time based on the given resolution.
 * @param {number} time Original time (ms).
 * @param {number} resolution Flooring resolution (ms).
 * @param {string=} userTimeZone Time zone.
 * @return {number} Floored time (ms).
 * @export
 */
export const floorTime = (time, resolution, userTimeZone) => {
  let date,
    hours,
    minutes,
    seconds,
    milliseconds,
    timeZone
  timeZone = (userTimeZone == null) ? 'UTC' : userTimeZone
  date = tz(time, timeZone)
  if (resolution &lt; 1000) {
    milliseconds = date.milliseconds()
    date.milliseconds(milliseconds - milliseconds % resolution)
  } else if (resolution &lt; 60 * 1000) {
    seconds = date.seconds()
    date.seconds(seconds - seconds % (resolution / 1000))
    date.milliseconds(0)
  } else if (resolution &lt; 60 * 60 * 1000) {
    minutes = date.minutes()
    date.minutes(minutes - minutes % (resolution / (60 * 1000)))
    date.seconds(0)
    date.milliseconds(0)
  } else if (resolution &lt; 24 * 60 * 60 * 1000) {
    hours = date.hours()
    date.hours(hours - hours % (resolution / (60 * 60 * 1000)))
    date.minutes(0)
    date.seconds(0)
    date.milliseconds(0)
  } else if (resolution &lt; 7 * 24 * 60 * 60 * 1000) {
    date.hours(0)
    date.minutes(0)
    date.seconds(0)
    date.milliseconds(0)
  }
  return date.valueOf()
}

/**
 * Adds compatibility definitions for older browsers.
 */
export const supportOldBrowsers = () => {
  // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
  // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
  // requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel
  // MIT license
  ((() => {
    let lastTime = 0
    const vendors = ['ms', 'moz', 'webkit', 'o']
    for (let x = 0; x &lt; vendors.length &amp;&amp; !window.requestAnimationFrame; ++x) {
      window.requestAnimationFrame = window[`${vendors[x]}RequestAnimationFrame`]
      window.cancelAnimationFrame = window[`${vendors[x]}CancelAnimationFrame`] ||
        window[`${vendors[x]}CancelRequestAnimationFrame`]
    }

    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = (callback, element) => {
        const currTime = Date.now()
        const timeToCall = Math.max(0, 16 - (currTime - lastTime))
        const id = window.setTimeout(() => {
          callback(currTime + timeToCall)
        }, timeToCall)
        lastTime = currTime + timeToCall
        return id
      }
    }

    if (!window.cancelAnimationFrame) {
      window.cancelAnimationFrame = id => {
        clearTimeout(id)
      }
    }
  })())
}

/**
 * Generate an HTML list representing a dropdown menu.
 * @param {Object} options Menu data.
 * @return {HTMLElement} Unordered list of menu items.
 */
export const createMenu = (options) => {
  let ul = document.createElement('ul')
  let li
  let a
  ul.classList.add('metoclient-menu')
  if (options.id != null) {
    ul.setAttribute('id', 'window-menu-dots-' + options.id)
  }
  if (options.items != null) {
    options.items.forEach((item) => {
      li = document.createElement('li')
      a = document.createElement('a')
      a.href = '#'
      a.innerHTML = item.title
      li.appendChild(a)
      if (typeof item.callback === 'function') {
        li.addEventListener('click', item.callback)
      }
      ul.appendChild(li)
    })
  }
  return ul
}

/**
 * Generate an HTML list containing ranges to control timeslider.
 * @param {Object} options Menu data.
 * @return {HTMLElement} Unordered list of menu items.
 */
export const createTimeMenu = (menuTimeSteps, options) => {
  let ul = document.createElement('ul')
  let form
  let li
  let a
  let title
  let output
  ul.classList.add('metoclient-menu')
  if (options.id != null) {
    ul.classList.add(options.id)
  }
  let exit = document.createElement('button')
  exit.id = 'fmi-metoclient-timeslider-menu-exit'
  exit.addEventListener('click', () => {
    ul.classList.remove('visible-menu')
  })
  ul.appendChild(exit)
  if (options.items != null) {
    options.items.forEach((item) => {
      if (item.type === 'button') {
        li = document.createElement('li')
        a = document.createElement('a')
        a.href = '#'
        a.innerHTML = item.title
        li.appendChild(a)
        if (typeof item.callback === 'function') {
          li.addEventListener('click', item.callback)
        }
        ul.appendChild(li)
      } else if (item.type === 'range') {
        li = document.createElement('li')
        form = document.createElement('form')
        title = document.createElement('a')
        title.innerHTML = item.title
        a = document.createElement('input')
        a.setAttribute('type', 'range')
        a.setAttribute('min', '0')
        a.setAttribute('max', item.size)
        output = document.createElement('output')
        if (item.id === 'fmi-metoclient-timeslider-begintime') {
          output.setAttribute('for', 'begin')
          output.setAttribute('onforminput', 'value = begin.valueAsNumber;')
          a.setAttribute('value', Math.floor(item.beginPlace))
          a.setAttribute('name', 'begin')
          form.setAttribute('id', 'beginForm')
        } else if (item.id === 'fmi-metoclient-timeslider-endtime') {
          output.setAttribute('for', 'end')
          output.setAttribute('onforminput', 'value = end.valueAsNumber;')
          a.setAttribute('value', Math.ceil(item.endPlace))
          a.setAttribute('name', 'end')
          form.setAttribute('id', 'endForm')
        }
        a.classList.add(item.id)
        a.href = '#'
        li.appendChild(title)
        li.appendChild(form)
        form.appendChild(a)
        form.appendChild(output)
        if (typeof item.callback === 'function') {
          li.addEventListener('click', item.callback)
        }
        ul.appendChild(li)
      } else if (item.type === 'stepButtons') {
        li = document.createElement('li')
        title = document.createElement('a')
        title.innerHTML = item.title
        li.appendChild(title)
        menuTimeSteps.forEach(function(timeStep) {
          let button = document.createElement('button')
          button.innerHTML = timeStep[0]
          button.classList.add('fmi-metoclient-timeslider-timestep-button')
          if (item.resolutionTime == timeStep[1]) {
            button.classList.add('fmi-metoclient-timeslider-timestep-active-button')
          }
          button.addEventListener('click', item.callback)
          li.appendChild(button)
        })
        ul.appendChild(li)
      } else {
        console.log('Unsupported')
      }
    })
  }
  return ul
}

/**
 * Transforms coordinates between projections.
 * @param fromProjection {string} Source projection.
 * @param toProjection {string} Target projection.
 * @param coordinates {number[]} Coordinates to be transformed.
 * @return {number[]} Transformed coordinates.
 */
export const transformCoordinates = (fromProjection, toProjection, coordinates) => {
  return proj4(fromProjection, toProjection, coordinates)
}

/**
 * Defines comparison filters between two variables.
 */
export const filters = [
  {
    'name': 'equalTo',
    'test': (a, b) => (a === b)
  },
  {
    'name': 'lessThan',
    'test': (a, b) => (a &lt; b)
  },
  {
    'name': 'lessThanOrEqualTo',
    'test': (a, b) => (a &lt;= b)
  },
  {
    'name': 'greaterThan',
    'test': (a, b) => (a > b)
  },
  {
    'name': 'greaterThanOrEqualTo',
    'test': (a, b) => (a >= b)
  },
  {
    'name': 'between',
    'test': (a, b) => ((b[0] &lt;= a) &amp;&amp; (a &lt;= b[1]))
  }
]
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Base.html">Base</a></li><li><a href="Html.html">Html</a></li><li><a href="Internal.html">Internal</a></li><li><a href="MetOClient_MetOClient.html">MetOClient</a></li><li><a href="module.exports.html">exports</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="TimeFrame.module.exports.html">module.exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addFeatures">addFeatures</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#clearFeatures">clearFeatures</a></li><li><a href="global.html#configureTicks">configureTicks</a></li><li><a href="global.html#createContainers">createContainers</a></li><li><a href="global.html#createFrame">createFrame</a></li><li><a href="global.html#createFrames">createFrames</a></li><li><a href="global.html#createIndicators">createIndicators</a></li><li><a href="global.html#createMap">createMap</a></li><li><a href="global.html#createMenu">createMenu</a></li><li><a href="global.html#createPointer">createPointer</a></li><li><a href="global.html#createPostTools">createPostTools</a></li><li><a href="global.html#createPreMargin">createPreMargin</a></li><li><a href="global.html#createPreTools">createPreTools</a></li><li><a href="global.html#createTicks">createTicks</a></li><li><a href="global.html#createTime">createTime</a></li><li><a href="global.html#createTimeMenu">createTimeMenu</a></li><li><a href="global.html#createTimer">createTimer</a></li><li><a href="global.html#createTimeSlider">createTimeSlider</a></li><li><a href="global.html#createTimeZoneLabel">createTimeZoneLabel</a></li><li><a href="global.html#destroyAnimation">destroyAnimation</a></li><li><a href="global.html#destroyTime">destroyTime</a></li><li><a href="global.html#destroyTimer">destroyTimer</a></li><li><a href="global.html#destroyTimeSlider">destroyTimeSlider</a></li><li><a href="global.html#featureFactory">featureFactory</a></li><li><a href="global.html#filters">filters</a></li><li><a href="global.html#floorTime">floorTime</a></li><li><a href="global.html#getAnimationBackupTime">getAnimationBackupTime</a></li><li><a href="global.html#getAnimationBeginTime">getAnimationBeginTime</a></li><li><a href="global.html#getAnimationEndTime">getAnimationEndTime</a></li><li><a href="global.html#getAnimationNumIntervals">getAnimationNumIntervals</a></li><li><a href="global.html#getAnimationResolutionTime">getAnimationResolutionTime</a></li><li><a href="global.html#getAnimationTime">getAnimationTime</a></li><li><a href="global.html#getAnimationTimes">getAnimationTimes</a></li><li><a href="global.html#getCapabilities">getCapabilities</a></li><li><a href="global.html#getCreationTime">getCreationTime</a></li><li><a href="global.html#getCurrentTime">getCurrentTime</a></li><li><a href="global.html#getFeatures">getFeatures</a></li><li><a href="global.html#getFeaturesAt">getFeaturesAt</a></li><li><a href="global.html#getLayer">getLayer</a></li><li><a href="global.html#getLayerConfigs">getLayerConfigs</a></li><li><a href="global.html#getLayers">getLayers</a></li><li><a href="global.html#getMap">getMap</a></li><li><a href="global.html#getRefreshInterval">getRefreshInterval</a></li><li><a href="global.html#getStaticControls">getStaticControls</a></li><li><a href="global.html#getTickText">getTickText</a></li><li><a href="global.html#getTimeConfiguration">getTimeConfiguration</a></li><li><a href="global.html#getTimeLimitsForced">getTimeLimitsForced</a></li><li><a href="global.html#handleRefresh_">handleRefresh_</a></li><li><a href="global.html#handleTimer_">handleTimer_</a></li><li><a href="global.html#hidePopup">hidePopup</a></li><li><a href="global.html#isValidRefreshInterval">isValidRefreshInterval</a></li><li><a href="global.html#isWaitingAutoStart">isWaitingAutoStart</a></li><li><a href="global.html#layerFactory">layerFactory</a></li><li><a href="global.html#LEGEND_CONTAINER_CLASS">LEGEND_CONTAINER_CLASS</a></li><li><a href="global.html#LEGEND_FIGURE_CLASS_PREFIX">LEGEND_FIGURE_CLASS_PREFIX</a></li><li><a href="global.html#loadCapabilities">loadCapabilities</a></li><li><a href="global.html#loadFunction">loadFunction</a></li><li><a href="global.html#LOADING_STATUS">LOADING_STATUS</a></li><li><a href="global.html#MAX_TIMESTAMP">MAX_TIMESTAMP</a></li><li><a href="global.html#moveAnimationTimeFrame">moveAnimationTimeFrame</a></li><li><a href="global.html#next">next</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#previous">previous</a></li><li><a href="global.html#produceFullLayerConfig">produceFullLayerConfig</a></li><li><a href="global.html#refreshLayers">refreshLayers</a></li><li><a href="global.html#refreshMap">refreshMap</a></li><li><a href="global.html#refreshTime">refreshTime</a></li><li><a href="global.html#requestViewUpdate">requestViewUpdate</a></li><li><a href="global.html#resetAnimationBackupTime">resetAnimationBackupTime</a></li><li><a href="global.html#selectFeature">selectFeature</a></li><li><a href="global.html#setAnimationLastRefreshed">setAnimationLastRefreshed</a></li><li><a href="global.html#setAnimationPlay">setAnimationPlay</a></li><li><a href="global.html#setAnimationTime">setAnimationTime</a></li><li><a href="global.html#setAnimationTimes">setAnimationTimes</a></li><li><a href="global.html#setBeginTime">setBeginTime</a></li><li><a href="global.html#setCallbacks">setCallbacks</a></li><li><a href="global.html#setCapabilities">setCapabilities</a></li><li><a href="global.html#setCenter">setCenter</a></li><li><a href="global.html#setCurrentTime">setCurrentTime</a></li><li><a href="global.html#setDayStartOffset">setDayStartOffset</a></li><li><a href="global.html#setDefaultTime">setDefaultTime</a></li><li><a href="global.html#setDragging">setDragging</a></li><li><a href="global.html#setEndTime">setEndTime</a></li><li><a href="global.html#setFirstDataPointTime">setFirstDataPointTime</a></li><li><a href="global.html#setFrameRate">setFrameRate</a></li><li><a href="global.html#setGridTime">setGridTime</a></li><li><a href="global.html#setInteractions">setInteractions</a></li><li><a href="global.html#setLastDataPointTime">setLastDataPointTime</a></li><li><a href="global.html#setLayers">setLayers</a></li><li><a href="global.html#setLayerVisible">setLayerVisible</a></li><li><a href="global.html#setMarkerVisible">setMarkerVisible</a></li><li><a href="global.html#setResolutionTime">setResolutionTime</a></li><li><a href="global.html#setRotation">setRotation</a></li><li><a href="global.html#setStaticControls">setStaticControls</a></li><li><a href="global.html#setTimeLimitsForced">setTimeLimitsForced</a></li><li><a href="global.html#setTimeStep">setTimeStep</a></li><li><a href="global.html#setTimeZone">setTimeZone</a></li><li><a href="global.html#setTimeZoneLabel">setTimeZoneLabel</a></li><li><a href="global.html#setZoom">setZoom</a></li><li><a href="global.html#showPopup">showPopup</a></li><li><a href="global.html#showTicks">showTicks</a></li><li><a href="global.html#sourceFactory">sourceFactory</a></li><li><a href="global.html#step">step</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#styleFactory">styleFactory</a></li><li><a href="global.html#supportOldBrowsers">supportOldBrowsers</a></li><li><a href="global.html#transformCoordinates">transformCoordinates</a></li><li><a href="global.html#updateAnimationBackupTime">updateAnimationBackupTime</a></li><li><a href="global.html#updateLayers">updateLayers</a></li><li><a href="global.html#updatePointer">updatePointer</a></li><li><a href="global.html#updateTimeLoaderVis">updateTimeLoaderVis</a></li><li><a href="global.html#updateTimeLoaderVisualizations">updateTimeLoaderVisualizations</a></li><li><a href="global.html#updateTimeSlider">updateTimeSlider</a></li><li><a href="global.html#updateTimeSteps">updateTimeSteps</a></li><li><a href="global.html#urlToDataUrl">urlToDataUrl</a></li><li><a href="global.html#ZINDEX">ZINDEX</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Sat Jul 27 2019 13:10:22 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
