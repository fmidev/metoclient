<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: view/map/FeatureProducer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: view/map/FeatureProducer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import OlGeomPoint from 'ol/geom/point'
import OlGeomMultiPoint from 'ol/geom/multipoint'
import OlGeomLineString from 'ol/geom/linestring'
import OlGeomMultiLineString from 'ol/geom/multilinestring'
import OlGeomPolygon from 'ol/geom/polygon'
import OlGeomMultiPolygon from 'ol/geom/multipolygon'
import OlFeature from 'ol/feature'
import OlStyleFill from 'ol/style/fill'
import OlStyleIcon from 'ol/style/icon'
import OlStyleStroke from 'ol/style/stroke'
import OlStyleStyle from 'ol/style/style'
import OlStyleText from 'ol/style/text'
import OlStyleCircle from 'ol/style/circle'
import OlStyleRegularShape from 'ol/style/regularshape'
import * as utils from '../../utils'
import extend from 'extend'

/**
 * @fileoverview Map source factory.
 * @author Finnish Meteorological Institute
 * @license MIT
 */
export default class FeatureProducer {
  /**
   * Creates new features.
   * @param options Feature options.
   * @returns {Array} Features.
   */
  featureFactory (options) {
    let newFeature
    const features = []
    const z = {
      'value': 0
    }
    options.forEach(feature => {
      if (feature['type'] != null) {
        switch (feature['type'].toLowerCase()) {
          case 'point':
            feature['geometry'] = new OlGeomPoint(feature['geometry'])
            break
          case 'multipoint':
            feature['geometry'] = new OlGeomMultiPoint(feature['geometry'])
            break
          case 'linestring':
            feature['geometry'] = new OlGeomLineString(feature['geometry'])
            break
          case 'multilinestring':
            feature['geometry'] = new OlGeomMultiLineString(feature['geometry'])
            break
          case 'polygon':
            feature['geometry'] = new OlGeomPolygon(feature['geometry'])
            break
          case 'multipolygon':
            feature['geometry'] = new OlGeomMultiPolygon(feature['geometry'])
            break
          default:
            return
        }
        newFeature = new OlFeature(feature)
      } else {
        newFeature = feature
      }
      newFeature.setId(features.length + '_' + Date.now())
      if (feature['style'] != null) {
        feature['style'] = this.styleFactory(feature['style'], z)
        newFeature.setStyle(feature['style'])
      }
      features.push(newFeature)
    })
    return features
  }

  /**
   * Creates a feature style.
   * @param options Style options.
   * @param z Z-index.
   * @returns {ol.style.Style} Feature style.
   */
  styleFactory (options, z) {
    if (options == null) {
      return null
    }
    // Filter conditions
    return (feature, resolution) => (Array.isArray(options) ? options : [options]).reduce((styles, option) => {
      let styleOptions = extend(true, {}, option)
      let numProperties
      let i
      let j
      let name
      let value
      let filter
      let numFilters
      let property
      let maxRadius = feature.get('maxRadius')
      let resolutionFactor = feature.get('resolutionFactor')
      if (styleOptions['condition'] != null) {
        numFilters = utils['filters'].length
        if (Array.isArray(styleOptions['condition']['properties'])) {
          numProperties = styleOptions['condition']['properties'].length
          for (i = 0; i &lt; numProperties; i++) {
            property = styleOptions['condition']['properties'][i]
            name = property['name']
            if ((name != null) &amp;&amp; (name.length > 0)) {
              value = feature.get(name)
              if (value != null) {
                for (j = 0; j &lt; numFilters; j++) {
                  filter = property[utils['filters'][j]['name']]
                  if ((typeof filter !== 'undefined') &amp;&amp; (!utils['filters'][j]['test'](value, filter))) {
                    return styles
                  }
                }
              }
            }
          }
        }
      }
      if ((styleOptions['image'] !== undefined) &amp;&amp; (styleOptions['image']['type'] !== undefined)) {
        if (styleOptions['image']['type'].toLowerCase() === 'icon') {
          styleOptions['image'] = new OlStyleIcon(/** @type {olx.style.IconOptions} */ (styleOptions['image']))
        } else if (['circle', 'regularshape'].includes(styleOptions['image']['type'].toLowerCase())) {
          if (styleOptions['image']['stroke'] !== undefined) {
            styleOptions['image']['stroke'] = new OlStyleStroke(styleOptions['image']['stroke'])
          }
          if (styleOptions['image']['fill'] !== undefined) {
            styleOptions['image']['fill'] = new OlStyleFill(styleOptions['image']['fill'])
          }
          styleOptions['image'] = (styleOptions['image']['type'].toLowerCase() === 'circle') ? new OlStyleCircle(styleOptions['image']) : new OlStyleRegularShape(styleOptions['image'])
        }
        z['value'] = z['value'] | 8
      }
      if (styleOptions['text'] !== undefined) {
        if (styleOptions['text']['fill'] !== undefined) {
          styleOptions['text']['fill'] = new OlStyleFill(styleOptions['text']['fill'])
        }
        if (styleOptions['text']['stroke'] !== undefined) {
          styleOptions['text']['stroke'] = new OlStyleStroke(styleOptions['text']['stroke'])
        }
        styleOptions['text'] = new OlStyleText(styleOptions['text'])
        z['value'] = z['value'] | 4
      }
      if (styleOptions['stroke'] !== undefined) {
        styleOptions['stroke'] = new OlStyleStroke((styleOptions['stroke']))
        z['value'] = z['value'] | 2
      }
      if (styleOptions['fill'] !== undefined) {
        styleOptions['fill'] = new OlStyleFill((styleOptions['fill']))
        z['value'] = z['value'] | 1
      }
      if (styleOptions['zIndex'] === undefined) {
        styleOptions['zIndex'] = Math.sqrt(feature.getGeometry().getCoordinates().reduce((result, coord) => result + coord * coord, 0))
      }
      if ((typeof maxRadius === 'number') &amp;&amp; (typeof resolutionFactor === 'number') &amp;&amp; (styleOptions['image'] != null) &amp;&amp; (typeof styleOptions['image']['setRadius'] === 'function')) {
        styleOptions['image']['setRadius'](Math.max(1, maxRadius - resolutionFactor * Math.LOG2E * Math.log(resolution)))
      }
      return new OlStyleStyle(styleOptions)
    }, [])
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="global.html#ContextMenu">ContextMenu</a></li><li><a href="Html.html">Html</a></li><li><a href="Internal.html">Internal</a></li><li><a href="MetOClient_MetOClient.html">MetOClient</a></li><li><a href="module.exports.html">exports</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="TimeFrame.module.exports.html">module.exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addClass">addClass</a></li><li><a href="global.html#addFeatures">addFeatures</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#clearFeatures">clearFeatures</a></li><li><a href="global.html#configureTicks">configureTicks</a></li><li><a href="global.html#contains">contains</a></li><li><a href="global.html#coordinateClicked">coordinateClicked</a></li><li><a href="global.html#createContainers">createContainers</a></li><li><a href="global.html#createFrame">createFrame</a></li><li><a href="global.html#createFrames">createFrames</a></li><li><a href="global.html#createIndicators">createIndicators</a></li><li><a href="global.html#createMap">createMap</a></li><li><a href="global.html#createMenu">createMenu</a></li><li><a href="global.html#createPointer">createPointer</a></li><li><a href="global.html#createPostTools">createPostTools</a></li><li><a href="global.html#createPreMargin">createPreMargin</a></li><li><a href="global.html#createPreTools">createPreTools</a></li><li><a href="global.html#createTicks">createTicks</a></li><li><a href="global.html#createTime">createTime</a></li><li><a href="global.html#createTimeMenu">createTimeMenu</a></li><li><a href="global.html#createTimer">createTimer</a></li><li><a href="global.html#createTimeSlider">createTimeSlider</a></li><li><a href="global.html#createTimeZoneLabel">createTimeZoneLabel</a></li><li><a href="global.html#destroyAnimation">destroyAnimation</a></li><li><a href="global.html#destroyTime">destroyTime</a></li><li><a href="global.html#destroyTimer">destroyTimer</a></li><li><a href="global.html#destroyTimeSlider">destroyTimeSlider</a></li><li><a href="global.html#eventHandler">eventHandler</a></li><li><a href="global.html#featureFactory">featureFactory</a></li><li><a href="global.html#filters">filters</a></li><li><a href="global.html#find">find</a></li><li><a href="global.html#floorTime">floorTime</a></li><li><a href="global.html#getAnimationBackupTime">getAnimationBackupTime</a></li><li><a href="global.html#getAnimationBeginTime">getAnimationBeginTime</a></li><li><a href="global.html#getAnimationEndTime">getAnimationEndTime</a></li><li><a href="global.html#getAnimationNumIntervals">getAnimationNumIntervals</a></li><li><a href="global.html#getAnimationResolutionTime">getAnimationResolutionTime</a></li><li><a href="global.html#getAnimationTime">getAnimationTime</a></li><li><a href="global.html#getAnimationTimes">getAnimationTimes</a></li><li><a href="global.html#getCapabilities">getCapabilities</a></li><li><a href="global.html#getCreationTime">getCreationTime</a></li><li><a href="global.html#getCurrentTime">getCurrentTime</a></li><li><a href="global.html#getFeatures">getFeatures</a></li><li><a href="global.html#getFeaturesAt">getFeaturesAt</a></li><li><a href="global.html#getLayer">getLayer</a></li><li><a href="global.html#getLayerConfigs">getLayerConfigs</a></li><li><a href="global.html#getLayers">getLayers</a></li><li><a href="global.html#getMap">getMap</a></li><li><a href="global.html#getRefreshInterval">getRefreshInterval</a></li><li><a href="global.html#getStaticControls">getStaticControls</a></li><li><a href="global.html#getTickText">getTickText</a></li><li><a href="global.html#getTimeConfiguration">getTimeConfiguration</a></li><li><a href="global.html#getTimeLimitsForced">getTimeLimitsForced</a></li><li><a href="global.html#handleRefresh_">handleRefresh_</a></li><li><a href="global.html#handleTimer_">handleTimer_</a></li><li><a href="global.html#hasClass">hasClass</a></li><li><a href="global.html#hidePopup">hidePopup</a></li><li><a href="global.html#isValidRefreshInterval">isValidRefreshInterval</a></li><li><a href="global.html#isWaitingAutoStart">isWaitingAutoStart</a></li><li><a href="global.html#items">items</a></li><li><a href="global.html#layerFactory">layerFactory</a></li><li><a href="global.html#LEGEND_CONTAINER_CLASS">LEGEND_CONTAINER_CLASS</a></li><li><a href="global.html#LEGEND_FIGURE_CLASS_PREFIX">LEGEND_FIGURE_CLASS_PREFIX</a></li><li><a href="global.html#lineHeight">lineHeight</a></li><li><a href="global.html#loadCapabilities">loadCapabilities</a></li><li><a href="global.html#loadFunction">loadFunction</a></li><li><a href="global.html#LOADING_STATUS">LOADING_STATUS</a></li><li><a href="global.html#map">map</a></li><li><a href="global.html#MAX_TIMESTAMP">MAX_TIMESTAMP</a></li><li><a href="global.html#mergeOptions">mergeOptions</a></li><li><a href="global.html#moveAnimationTimeFrame">moveAnimationTimeFrame</a></li><li><a href="global.html#next">next</a></li><li><a href="global.html#opened">opened</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#pixelClicked">pixelClicked</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#previous">previous</a></li><li><a href="global.html#produceFullLayerConfig">produceFullLayerConfig</a></li><li><a href="global.html#refreshLayers">refreshLayers</a></li><li><a href="global.html#refreshMap">refreshMap</a></li><li><a href="global.html#refreshTime">refreshTime</a></li><li><a href="global.html#removeClass">removeClass</a></li><li><a href="global.html#requestViewUpdate">requestViewUpdate</a></li><li><a href="global.html#resetAnimationBackupTime">resetAnimationBackupTime</a></li><li><a href="global.html#selectFeature">selectFeature</a></li><li><a href="global.html#setAnimationLastRefreshed">setAnimationLastRefreshed</a></li><li><a href="global.html#setAnimationPlay">setAnimationPlay</a></li><li><a href="global.html#setAnimationTime">setAnimationTime</a></li><li><a href="global.html#setAnimationTimes">setAnimationTimes</a></li><li><a href="global.html#setBeginTime">setBeginTime</a></li><li><a href="global.html#setCallbacks">setCallbacks</a></li><li><a href="global.html#setCapabilities">setCapabilities</a></li><li><a href="global.html#setCenter">setCenter</a></li><li><a href="global.html#setCurrentTime">setCurrentTime</a></li><li><a href="global.html#setDayStartOffset">setDayStartOffset</a></li><li><a href="global.html#setDefaultTime">setDefaultTime</a></li><li><a href="global.html#setDragging">setDragging</a></li><li><a href="global.html#setEndTime">setEndTime</a></li><li><a href="global.html#setFirstDataPointTime">setFirstDataPointTime</a></li><li><a href="global.html#setFrameRate">setFrameRate</a></li><li><a href="global.html#setGridTime">setGridTime</a></li><li><a href="global.html#setInteractions">setInteractions</a></li><li><a href="global.html#setLastDataPointTime">setLastDataPointTime</a></li><li><a href="global.html#setLayers">setLayers</a></li><li><a href="global.html#setLayerVisible">setLayerVisible</a></li><li><a href="global.html#setMarkerVisible">setMarkerVisible</a></li><li><a href="global.html#setResolutionTime">setResolutionTime</a></li><li><a href="global.html#setRotation">setRotation</a></li><li><a href="global.html#setStaticControls">setStaticControls</a></li><li><a href="global.html#setTimeLimitsForced">setTimeLimitsForced</a></li><li><a href="global.html#setTimeStep">setTimeStep</a></li><li><a href="global.html#setTimeZone">setTimeZone</a></li><li><a href="global.html#setTimeZoneLabel">setTimeZoneLabel</a></li><li><a href="global.html#setZoom">setZoom</a></li><li><a href="global.html#showPopup">showPopup</a></li><li><a href="global.html#showTicks">showTicks</a></li><li><a href="global.html#sourceFactory">sourceFactory</a></li><li><a href="global.html#step">step</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#styleFactory">styleFactory</a></li><li><a href="global.html#submenu">submenu</a></li><li><a href="global.html#supportOldBrowsers">supportOldBrowsers</a></li><li><a href="global.html#transformCoordinates">transformCoordinates</a></li><li><a href="global.html#updateAnimationBackupTime">updateAnimationBackupTime</a></li><li><a href="global.html#updateLayers">updateLayers</a></li><li><a href="global.html#updatePointer">updatePointer</a></li><li><a href="global.html#updateTimeLoaderVis">updateTimeLoaderVis</a></li><li><a href="global.html#updateTimeLoaderVisualizations">updateTimeLoaderVisualizations</a></li><li><a href="global.html#updateTimeSlider">updateTimeSlider</a></li><li><a href="global.html#updateTimeSteps">updateTimeSteps</a></li><li><a href="global.html#urlToDataUrl">urlToDataUrl</a></li><li><a href="global.html#viewport">viewport</a></li><li><a href="global.html#ZINDEX">ZINDEX</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Nov 04 2019 07:43:22 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
