<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Animator example</title>
    <script src='../../dist/metoclient.min.js'></script>
    <link href='../../dist/css/map.css' rel='stylesheet' type='text/css'>
    <link href='../../dist/css/timeSlider.css' rel='stylesheet' type='text/css'>
    <link href='../../dist/css/example.css' rel='stylesheet' type='text/css'>
</head>
<body>
<div class='fmi-metoclient'>
    <!-- The map will be inserted here -->
</div>
<script>
    // Initialize options objects for animation.
    var resolutionTime = 60 * 60 * 1000
    var currentDate = new Date()
    var currentTime = fi.fmi.metoclient.MetOClient.floorTime(currentDate.getTime(), resolutionTime)
    var beginTime = currentTime - 5 * resolutionTime
    var endTime = currentTime + 5 * resolutionTime
    var resolutions = [2048, 1024, 512, 256, 128, 64]
    var wmsBaseUrl = 'http://openwms.fmi.fi/geoserver/wms'
    var origins1024 = [[-118331.36640836, 8432773.1670142], [-118331.36640836, 8432773.1670142], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352], [-118331.36640836, 7907751.53726352]]
    var extent = [-1000000, 5000000, 5000000, 20000000]
    // Create animation layers.
    // Animation specific configurations are located inside animation property.
    // Many of these values are given here to show them as an example.
    // Usually, default values may be enough.
    var config = {
      project: 'mymap',
      // Map view configurations
      // Layer configuration
      layers: {
        // ---------------------------------------------------------------
        'OpenStreetMap': {
          className: 'OSM',
          title: 'OpenStreetMap',
          visible: true,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
        },
        // ---------------------------------------------------------------
        'Stamen': {
          className: 'Stamen',
          title: 'Water Color',
          visible: false,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
          source: {
            layer: 'watercolor'
          }
        },
        // ---------------------------------------------------------------
        'Rain radar': {
          className: 'TileWMS',
          title: 'Rain radar and humidity forecast',
          visible: true,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
          type: 'obs',
          source: {
            url: wmsBaseUrl,
            params: {
              'LAYERS': 'Radar:suomi_rr_eureffin',
              'TRANSPARENT': 'TRUE',
              'FORMAT': 'image/png'
            },
            projection: 'EPSG:3857',
            tileGridOptions: {
              origins: origins1024,
              extent: extent,
              resolutions: resolutions,
              tileSize: 1024
            }
          },
          animation: {
            beginTime: beginTime,
            resolutionTime: resolutionTime,
            hasLegend: false,
          }
        },
        // ---------------------------------------------------------------
        'Humidity forecast': {
          className: 'TileWMS',
          title: 'Rain radar and humidity forecast',
          visible: true,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
          type: 'for',
          source: {
            url: wmsBaseUrl,
            params: {
              'LAYERS': 'Weather:precipitation-forecast',
              'TRANSPARENT': 'TRUE',
              'FORMAT': 'image/png'
            },
            projection: 'EPSG:3857',
            tileGridOptions: {
              origins: origins1024,
              extent: extent,
              resolutions: resolutions,
              tileSize: 1024
            }
          },
          animation: {
            endTime: endTime,
            resolutionTime: resolutionTime,
            hasLegend: false
          }
        },
        // ---------------------------------------------------------------
        'Cloudiness forecast': {
          className: 'TileWMS',
          title: 'Cloudiness forecast',
          visible: false,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
          type: 'for',
          source: {
            url: wmsBaseUrl,
            params: {
              'LAYERS': 'Weather:cloudiness-forecast',
              'TRANSPARENT': 'TRUE',
              'FORMAT': 'image/png'
            },
            projection: 'EPSG:3857',
            tileGridOptions: {
              origins: origins1024,
              extent: extent,
              resolutions: resolutions,
              tileSize: 1024
            }
          },
          animation: {
            beginTime: currentTime,
            endTime: endTime,
            resolutionTime: resolutionTime,
            hasLegend: true
          }
        },
        // ---------------------------------------------------------------
        'Temperature forecast': {
          className: 'TileWMS',
          title: 'Temperature forecast',
          visible: true,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
          type: 'for',
          source: {
            url: wmsBaseUrl,
            params: {
              'LAYERS': 'Weather:temperature-forecast-contour',
              'TRANSPARENT': 'TRUE',
              'FORMAT': 'image/png'
            },
            projection: 'EPSG:3857',
            tileGridOptions: {
              origins: origins1024,
              extent: extent,
              resolutions: resolutions,
              tileSize: 1024
            }
          },
          animation: {
            beginTime: currentTime,
            endTime: endTime,
            resolutionTime: resolutionTime,
            hasLegend: false
          }
        },
        // ---------------------------------------------------------------
        'Markers': {
          className: 'Vector',
          type: 'features',
          title: 'Markers',
          visible: false,
          useSavedVisible: true,
          editOpacity: true,
          useSavedOpacity: true,
          source: {
            projection: 'EPSG:4326',
            features: [
              {
                type: 'Point',
                geometry: [25, 61],
                name: 'Point 1',
                population: 1000,
                text: 'Description A'
              },
              {
                type: 'Point',
                geometry: [26, 63],
                name: 'Point 2',
                population: 2000,
                text: 'Description B'
              }
            ]
          },
          style: [
            {
              image: {
                type: 'icon',
                anchor: [0.5, 0.5],
                anchorXUnits: 'fraction',
                anchorYUnits: 'fraction',
                opacity: 0.75,
                rotation: 45,
                src: '../../img/icon.png'
              },
              text: {
                font: '12px helvetica,sans-serif',
                text: 'Kohde',
                rotation: 45,
                fill: {
                  color: 'rgba(0, 255, 0, 1.0)'
                },
                stroke: {
                  color: 'rgba(0, 0, 255, 1.0)',
                  width: 2,
                  lineCap: 'round',
                  lineJoin: 'miter',
                  lineDash: [1, 2],
                  miterLimit: 7
                }
              }
            }
          ]
        }
      },
      container: 'fmi-metoclient',
      projection: 'EPSG:3857',
      extent: [-1000000, 5000000, 10000000, 20000000],
      resolutions: resolutions,
      defaultCenterLocation: [2750000, 8500000],
      defaultCenterProjection: 'EPSG:3857',
      defaultZoomLevel: 1,
      showLegend: true,
      showLayerSwitcher: true,
      showLoadProgress: true,
      markerImagePath: '../../img/marker.png',
      maxAsyncLoadCount: 5,
      // Disable panning and zooming
      staticControls: false,
      // Time configuration
      autoStart: false,
      waitUntilLoaded: false,
      autoReplay: true,
      refreshInterval: 15 * 60 * 1000,
      frameRate: 500,
      resolutionTime: resolutionTime,
      defaultAnimationTime: Date.now(),
      beginTime: beginTime,
      endTime: endTime,
      endTimeDelay: 1000,
      showTimeSlider: true,
      timeZone: 'Europe/Helsinki',
      // Localization
      localization: {
        locale: 'en',
        fi: {
          overlays: 'Sääaineistot',
          baseLayers: 'Taustakartat',
          features: 'Kohteet',
          legend: 'Selite',
          noLegend: 'Ei selitettä',
          zoomInTooltip: 'Lähennä',
          zoomOutTooltip: 'Loitonna',
          layersTooltip: 'Karttatasot',
          browserNotSupported: 'Tämä selain ei ole tuettu.'
        },
        en: {
          overlays: 'Overlays',
          baseLayers: 'Base layers',
          features: 'Features',
          legend: 'Legend',
          noLegend: 'None',
          zoomInTooltip: 'Zoom in',
          zoomOutTooltip: 'Zoom out',
          layersTooltip: 'Layers',
          browserNotSupported: 'This browser is not supported.'
        }
      }
    }
    var weatherVisualization = new fi.fmi.metoclient.MetOClient(config)
    weatherVisualization.createAnimation();
</script>
</body>
</html>
